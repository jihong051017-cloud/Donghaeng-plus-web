<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>디자인 템플릿</title>

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>


  <style>

    /* 지도 전체 크기 */
    #map {
      height: 100vh;
      width: 100%;
    }

/* 두 번째 팝업 전체 컨테이너 */
.leaflet-popup-content .popup-container {
  max-height: 500px;      /* 팝업 최대 높이 설정 */
  overflow-y: auto;       /* 내용이 많으면 스크롤 */
  width: 350px;           /* 원하는 가로 크기 조정 */
  padding: 5px 40px 5px 5px;
  box-sizing: border-box;
}

/* 카드 간 간격 조정 */
.popup-card {
  margin-bottom: 10px;
}

.popup-wrapper {
  max-width: 500px;
}

/* 제목 */
.popup-title {
  font-size: 24px;
  font-weight: bold;
  line-height: 2;
  color: #222;
}

/* 설명 */
.popup-desc {
  font-size: 14px;
  color: #555;
  line-height: 1.4;
}

/* 링크 */
.popup-link {
  color: #0066ff;
  text-decoration: underline;
  font-size: 13px;
  line-height: 2;
}

/* 이미지 스타일 */
.popup-img {
  width: 20%;          /* width=200 같은 고정값 대신 반응형 */
  max-width: 220px;     /* 팝업 안에서 넘치지 않도록 */
  margin-top: 5px;
  margin-bottom: 10px;
  border-radius: 8px;
  display: block;
}

    .popup-card {
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    .popup-card img {
      width: 15%;
      height: auto;
      display: block;
      margin-top: 25px;
      margin-left: 25px;
      border-radius: 6px;
    }
    .popup-card-content {
      padding: 10px 20px;
    }
    .popup-card-content h4 {
      margin: 8px 0;
      font-size: 24px;
      color: #333;
    }
    .popup-card-content p {
      font-size: 16px;
      color: #666;
      margin: 10;
    }



    .popup-btn {
  margin-top: 10px;
  padding: 6px 12px;
  border: none;
  background-color: #7d48ff;
  color: white;
  border-radius: 6px;
  cursor: pointer;
  font-size: 13px;
}

.popup-btn:hover {
  background-color: #5a2ed0;
}


    /* 투명한 마커용 클래스 */
    .transparent-marker {
      opacity: 0.01;
    }


  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    /* ---------------------------
       지도 기본 설정
    ----------------------------- */
    const map = L.map("map").setView([37.2455, 127.0809], 15.5);


    /* 지도 타일 (OpenStreetMap) */
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "© OpenStreetMap contributors",
    }).addTo(map);

    /* ---------------------------
       Polyline 경로 정의 (여기에 건물별 길 좌표 찍으면 될 듯)
    ----------------------------- */

    // 공대 길
    const engineeringRoad = L.polyline([
      [37.24744928621014,127.07841734170458],
      [37.247023514977876,127.07845916693653],
      [37.24547140872474,127.0785449066531],
      [37.24552004230549,127.07992563271284],
      [37.24588492710917,127.07998237243892],
      [37.24607825426014,127.08056866377224],
      [37.24635306884318,127.08057459181238],
      [37.24659640053806,127.0805015895062],
      [37.24675446500199,127.07993820740015],
      [37.24703832805987,127.07988778753116],
      [37.247060892163375,127.07983145609785],
      [37.24702126050105,127.07846198236037]
    ], { color: "red", weight: 5, opacity: 0.8 });


    // 체대 길
    const peRoad = L.polyline([
      [37.247248789953005,127.07843826722025],
      [37.24546916078659,127.07853786006163],
      [37.24532498998307,127.078543345847],
      [37.24521686094346,127.07854886901869],
      [37.24489247007228,127.07857107380067],
      [37.24480233198483,127.07862169843803],
      [37.24473470874797,127.07868925241509],
      [37.244594851797466,127.07898214477257],
      [37.2446332006517,127.07890047229672],
      [37.24451145067267,127.07906377010181],
      [37.244401038873015,127.0791143727058],
      [37.243840074727544,127.07920958618395],
      [37.2438307675567,127.07965194629782],
      [37.24386897469027,127.07978159812166],
      [37.2439522738143,127.07985212710062],
      [37.24462135618004,127.07976830286894],
      [37.244718288618486,127.0796641510417],
      [37.24469586477552,127.0795119730109],
      [37.244509201824386,127.07905813241727]
    ], { color: "red", weight: 5, opacity: 0.8 });


    // 도서관 길 (형광색)
    const libraryRoad = L.polyline([
      [37.247248789953005,127.07843826722025],
      [37.24546916078659,127.07853786006163],
      [37.24532498998307,127.078543345847],
      [37.24521686094346,127.07854886901869],
      [37.24489247007228,127.07857107380067],
      [37.24480233198483,127.07862169843803],
      [37.24473470874797,127.07868925241509],
      [37.244594851797466,127.07898214477257],
      [37.24452272313177,127.07904969353683],
      [37.24440103699051,127.07911719036744],
      [37.243842321684056,127.07921804146395],
      [37.243729672282555,127.07924609994475],
      [37.24364852923831,127.07931927351159],
      [37.2436168641912,127.07951083946755],
      [37.24360776664984,127.07964044107803],
      [37.24362972508455,127.08048011938003],
      [37.24357106904101,127.0806096681135],
      [37.2435124589425,127.08067159356287],
      [37.24253033581597,127.0806480060374],
      [37.24250704067593,127.08176938325934],
      [37.24245740145371,127.08188766846422],
      [37.24238077368678,127.08194393732957],
      [37.24140299190663,127.08215701273852],
      [37.24137594492579,127.08217952378943],
      [37.2414454827908,127.0793056946494],
      [37.241323962372604,127.07912524418893],
      [37.2406031679128,127.07906250523807],
      [37.240427370021166,127.07920319740585],
      [37.24031913144617,127.07937213485233],
      [37.24028749658483,127.07951861222654],
      [37.24025553072756,127.08015533574597],
      [37.240318531353864,127.08026246789974],
      [37.24027220025517,127.08212761031747],
      [37.241398482773555,127.08216264294789]
    ], { color: "#7CFF59", weight: 6, opacity: 0.8 });


    /* ---------------------------
       투명한 마커 아이콘 정의
    ----------------------------- */
    const transparentIcon = L.icon({
      iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
      iconSize: [25, 41],
      iconAnchor: [12, 41],
      popupAnchor: [1, -34],
      className: 'transparent-marker'
    });

    /* ---------------------------
       마커 + 팝업 데이터
    ----------------------------- */
    const locations = [
      {
        name: "공과대학",
        coords: [37.24615691029263, 127.08084065835392],
        desc: "기계공학과, 산업경영공학과, 화학공학과 등 공학계열 전공이 위치한 건물이에요",
        link: "https://eng.khu.ac.kr/",
        img: "https://postfiles.pstatic.net/MjAyNTExMTRfMTkg/MDAxNzYzMDk5NDgwNDQ5.vvZS0_1XzUf4C3ixesDt5TDJUy1oVfHd3aNa4IbygAAg.DrP6I_oftFAt4OrJkJYfczr2hOP06IJuJuv_PRWB0RMg.PNG/gear.png?type=w966",
        road: engineeringRoad,
        facilities: [
          {desc: "• 주 출입구 양쪽으로 경사로가 있어요<br>• 출입구 까지 언덕이 높아 이동이 힘들어요❗"},
          {desc: "• 건물의 모든 출입구가 자동문이에요"},
          {desc: "• 공과대학은 건물 양쪽으로 엘리베이터가 있어요.<br>• 엘리베이터 까지 가는 길의 경사가 급해요❗"},
          {desc: "• 1층에 장애인 화장실이 있어요"},
          {desc: "• 건물에 장애인 전용 주차장이 ()개 있어요"},
          {desc: "• 건물 내부 구조가 복잡해요<br>• 건물 모양에 따라 왼팔, 오른팔 등으로 불러요<br>• 오른팔은 공학실험동과 연결되어 있어요<br>• ⚠️경사가 급해 휠체어 혼자서 이동하기 어려워요"}
        ]
        
      },
      {
        name: "체육대학",
        coords: [37.244368520122684, 127.08057107017227],
        desc: "스포츠 관련 학과들이 위치합니다.",
        img: "https://postfiles.pstatic.net/MjAyNTExMTRfMjc2/MDAxNzYzMTA4NDQ3MTA4.73vHV2vLaaEs6vhpV-HhjpzCzJry4fzO9dAr_gNzGfMg.DGDfgHw1-lsAZGQwlEN3JiXd8z7EvObKePJr5--Lihcg.PNG/ball.png?type=w966",
        road: peRoad,
        facilities: [
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"}
        ]
        
      },
      {
        name: "중앙도서관",
        coords: [37.24088203083561, 127.07975027446633],
        desc: "학생들이 공부하고 자료를 찾는 공간입니다.",
        img: "https://postfiles.pstatic.net/MjAyNTExMTRfMjk0/MDAxNzYzMTA4NDg4MDg4.-_Op3Yfkk7wOPAVQCYNqJd-Me8xw3l0QFIMZ3P7hVJQg.VLMHZCS8DaWSL25XB5NPGuvFW79dHz-UWhye7oycXzEg.PNG/open-book_(1).png?type=w966",
        road: libraryRoad,
        facilities: [
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"},
          {desc: "세부 정보를 입력하세요 ㅋㅋ"}
        ]
      }
    ];

    let currentRoad = null;   // 현재 활성화된 길을 기억(새 길 클릭 시 기존 길 제거)

    

    locations.forEach((loc,i) => {
  const popup1 = `
    <div class="popup-wrapper">
      ${loc.img ? `<img src="${loc.img}" alt="${loc.name}" class="popup-img">` : ""}
      <b class="popup-title">${loc.name}</b><br>
      <span class="popup-desc">${loc.desc}</span><br>
      <a href="${loc.link}" target="_blank" class="popup-link">홈페이지 이동</a><br>

      <button class="popup-btn" id="openPopup${i}">다른 팝업 보기</button>
      
    </div>
  `;

  const popup2 = `
        <div class="popup-container">
          <div class="popup-card">
            <img src="https://postfiles.pstatic.net/MjAyNTExMTRfNCAg/MDAxNzYzMTA5ODI0NjQw.FV2fnucHXf1YYNXNoyPRzAasUq8-EFBS4vBTaY9u9Zkg.--F1Eob5TPYn3XlVovs6I8eFiCS87HdngGIYDZIWyOcg.PNG/ramp_(1).png?type=w966" alt="경사로">
            <div class="popup-card-content">
            <h4>경사로</h4>
            <p>${loc.facilities[0].desc}</p>
            </div>
          </div>

          <div class="popup-card">
            <img src="https://postfiles.pstatic.net/MjAyNTExMTRfMTEy/MDAxNzYzMTA5ODExNjY3.4aaNS6Caib0ZT7d4OBXXp9Q1LYyxWO152KXWoO4m-7og.HQpbu6wmLwGj25VFG85SzadncDHUCKz06my5AuJ_zGYg.PNG/open-exit-door.png?type=w966" alt="출입문">
            <div class="popup-card-content">
            <h4>출입문</h4>
            <p>${loc.facilities[1].desc}</p>
            </div>
          </div>

          <div class="popup-card">
            <img src="https://postfiles.pstatic.net/MjAyNTExMTFfNzgg/MDAxNzYyODYxMjc2NTEz.9GZPqo0QpzyBn4mLpuRVsF7tPcq7qv2uz6N68YHQujgg.M1VYAvnlfV62YSOzxg3WgzUD0KvqTkgn-wGTkDLhcb4g.PNG/lift-sign.png?type=w966" alt="엘리베이터">
            <div class="popup-card-content">
            <h4>엘리베이터</h4>
            <p>${loc.facilities[2].desc}</p>
            </div>
          </div>

            <div class="popup-card">
            <img src="https://postfiles.pstatic.net/MjAyNTExMTFfMjA5/MDAxNzYyODYxODUzNjA0.k3_3gdydilC_1xt8V5qncEtBgORwiUeZKvdLSP9sjvwg.DBW1P5zXbzTDcK0so0cdJjJLKKRf4sTa7Nlu4Ll5Tngg.PNG/toilet.png?type=w966" alt="화장실">
            <div class="popup-card-content">
            <h4>화장실</h4>
            <p>${loc.facilities[3].desc}</p>
            </div>
          </div>

            <div class="popup-card">
            <img src="https://postfiles.pstatic.net/MjAyNTExMTRfMjg3/MDAxNzYzMTA5ODQ2ODMw.aIJnLnEolwj8BH_W-WXHT6VuhtTv9pp93DH4MXItDlkg.duUr17jmijBdsIanzUHbaR4_FdE1DitPeDaJmbT0RkAg.PNG/parking.png?type=w966" alt="주차장">
            <div class="popup-card-content">
            <h4>주차장</h4>
            <p>${loc.facilities[4].desc}</p>
            </div>
          </div>

          <div class="popup-card">
            <img src="https://postfiles.pstatic.net/MjAyNTExMTRfMjE0/MDAxNzYzMTA5ODY1MDQz.hHU1_D_DL1JynbQYY2RHYtMOrN0XHu8t-Ijn4tlc1tMg.4SC7p5DmM0E3_Kp3qW75nH812BkhZPJJHJ_2vfeO28kg.PNG/warning.png?type=w966" alt="특이사항">
            <div class="popup-card-content">
            <h4>특이 사항</h4>
            <p>${loc.facilities[5].desc}</p>
            </div>
          </div>


        </div>

      `;

  /* 보이는 마커 (기본 팝업) */
  const marker = L.marker(loc.coords)
    .addTo(map)
    .bindPopup(popup1, { maxWidth: 300, offset: L.point(0, 0) });

    /* 투명 마커 (두 번째 팝업) */
      const hiddenMarker = L.marker(
        [loc.coords[0], loc.coords[1] + 0.0006],
        { icon: transparentIcon }
      ).addTo(map)
       .bindPopup(popup2, { maxWidth: 300 });  //팝업의 크기는 여기서 조정하면 됨 (이거 찾는 데 2시간 걸림...)

       /* ===================================================
         C) 처음 마커 클릭 시 길(road) 표시
      =================================================== */
      marker.on("click", () => {

        // 기존 길 제거
        if (currentRoad) map.removeLayer(currentRoad);

        // 새 길 추가
        if (loc.road) {
          loc.road.addTo(map);
          currentRoad = loc.road;
        }
      });

      /* 버튼 -> 두 번째 팝업 열기 */
      map.on("popupopen", () => {
        const btn = document.getElementById(`openPopup${i}`);
        if (btn) btn.addEventListener("click", () => hiddenMarker.openPopup());
      });
});
  </script>
</body>
</html>
